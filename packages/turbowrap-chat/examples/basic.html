<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>@turbowrap/chat - Demo</title>

  <!-- React -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

  <!-- TurboWrap Chat -->
  <link rel="stylesheet" href="../dist/style.css">
  <script src="../dist/turbowrap-chat.umd.js"></script>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          animation: {
            'fade-in': 'fadeIn 0.3s ease-out',
            'slide-up': 'slideUp 0.4s ease-out',
            'pulse-soft': 'pulseSoft 2s ease-in-out infinite',
            'gradient': 'gradient 8s ease infinite',
          },
        }
      }
    }
  </script>

  <style>
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @keyframes slideUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes pulseSoft {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
    @keyframes gradient {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    body {
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      background: linear-gradient(135deg, #0f0f23 0%, #1a1a3e 50%, #0f0f23 100%);
      background-size: 400% 400%;
      animation: gradient 15s ease infinite;
      min-height: 100vh;
    }

    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }
    ::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 3px;
    }
    ::-webkit-scrollbar-thumb {
      background: rgba(99, 102, 241, 0.5);
      border-radius: 3px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: rgba(99, 102, 241, 0.7);
    }

    /* Glass morphism effect */
    .glass {
      background: rgba(255, 255, 255, 0.03);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .glass-darker {
      background: rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.05);
    }

    /* Glow effects */
    .glow-indigo {
      box-shadow: 0 0 40px rgba(99, 102, 241, 0.15);
    }
    .glow-purple {
      box-shadow: 0 0 40px rgba(168, 85, 247, 0.15);
    }

    /* Demo sections */
    .demo-section {
      animation: slideUp 0.5s ease-out;
      animation-fill-mode: both;
    }
    .demo-section:nth-child(1) { animation-delay: 0.1s; }
    .demo-section:nth-child(2) { animation-delay: 0.2s; }
    .demo-section:nth-child(3) { animation-delay: 0.3s; }
    .demo-section:nth-child(4) { animation-delay: 0.4s; }
    .demo-section:nth-child(5) { animation-delay: 0.5s; }

    /* Chat container */
    .chat-container {
      height: 600px;
      display: flex;
      flex-direction: column;
    }

    /* Code block styling */
    .chat-code-block {
      background: rgba(0, 0, 0, 0.4);
      border-radius: 12px;
      overflow: hidden;
      margin: 12px 0;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    .chat-code-header {
      background: rgba(255, 255, 255, 0.05);
      padding: 8px 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 12px;
      color: rgba(255, 255, 255, 0.6);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    .chat-code-content {
      padding: 16px;
      margin: 0;
      overflow-x: auto;
    }
    .chat-code-content code {
      font-family: 'JetBrains Mono', 'Fira Code', monospace;
      font-size: 13px;
      line-height: 1.6;
      color: #e2e8f0;
    }

    /* Callouts */
    .chat-callout {
      padding: 12px 16px;
      border-radius: 8px;
      margin: 12px 0;
      display: flex;
      align-items: flex-start;
      font-size: 14px;
    }
    .chat-callout-info {
      background: rgba(59, 130, 246, 0.15);
      border-left: 3px solid #3b82f6;
      color: #93c5fd;
    }
    .chat-callout-warning {
      background: rgba(245, 158, 11, 0.15);
      border-left: 3px solid #f59e0b;
      color: #fcd34d;
    }
    .chat-callout-error {
      background: rgba(239, 68, 68, 0.15);
      border-left: 3px solid #ef4444;
      color: #fca5a5;
    }
    .chat-callout-success {
      background: rgba(16, 185, 129, 0.15);
      border-left: 3px solid #10b981;
      color: #6ee7b7;
    }
    .chat-callout-tip {
      background: rgba(168, 85, 247, 0.15);
      border-left: 3px solid #a855f7;
      color: #d8b4fe;
    }

    /* Message styling */
    .message-content {
      color: #e2e8f0;
      line-height: 1.7;
    }
    .message-content h1, .message-content h2, .message-content h3 {
      color: white;
    }
    .message-content table {
      width: 100%;
      border-collapse: collapse;
      margin: 16px 0;
    }
    .message-content th {
      background: rgba(255, 255, 255, 0.1);
      padding: 10px 12px;
      text-align: left;
      font-weight: 600;
    }
    .message-content td {
      padding: 10px 12px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }
    .message-content blockquote {
      border-left: 3px solid rgba(99, 102, 241, 0.5);
      padding-left: 16px;
      margin: 16px 0;
      color: rgba(255, 255, 255, 0.7);
      font-style: italic;
    }

    /* Button hover effects */
    .btn-glow:hover {
      box-shadow: 0 0 20px rgba(99, 102, 241, 0.4);
      transform: translateY(-1px);
    }
    .btn-glow {
      transition: all 0.2s ease;
    }

    /* Grid pattern background */
    .grid-pattern {
      background-image:
        linear-gradient(rgba(255, 255, 255, 0.02) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255, 255, 255, 0.02) 1px, transparent 1px);
      background-size: 50px 50px;
    }
  </style>
</head>
<body class="text-white grid-pattern">
  <div id="root"></div>

  <script>
    const { createElement: h, useState, useEffect } = React;
    const {
      MessageList,
      MessageItem,
      MessageInput,
      MessageFormatter,
      StreamingMessage,
      SessionTabs,
      HistoryPanel,
      ChatHeader,
      ChatPane,
      QuickSettings,
      RepoSelectorModal,
      SessionInfoModal,
      AgentAutocomplete,
      CodeBlock,
      Callout,
      ToolIndicator
    } = TurboWrapChat;

    // Mock data
    const mockSessions = [
      {
        id: '1',
        cliType: 'claude',
        displayName: 'Code Review Session',
        model: 'claude-sonnet-4-20250514',
        status: 'active',
        totalMessages: 5,
        createdAt: new Date(),
        updatedAt: new Date(),
        lastMessageAt: new Date(),
      },
      {
        id: '2',
        cliType: 'gemini',
        displayName: 'Bug Analysis',
        model: 'gemini-2.0-flash-exp',
        status: 'active',
        totalMessages: 3,
        createdAt: new Date(Date.now() - 3600000),
        updatedAt: new Date(Date.now() - 3600000),
        lastMessageAt: new Date(Date.now() - 3600000),
      },
      {
        id: '3',
        cliType: 'claude',
        displayName: 'Architecture Planning',
        model: 'claude-opus-4-20250514',
        status: 'active',
        totalMessages: 12,
        createdAt: new Date(Date.now() - 7200000),
        updatedAt: new Date(Date.now() - 7200000),
        lastMessageAt: new Date(Date.now() - 7200000),
      }
    ];

    const mockMessages = [
      {
        id: 'm1',
        sessionId: '1',
        role: 'user',
        content: 'Can you review this React component for potential issues?',
        createdAt: new Date(Date.now() - 60000),
      },
      {
        id: 'm2',
        sessionId: '1',
        role: 'assistant',
        content: `I'll analyze your React component. Here are my findings:

## Issues Found

### 1. Missing dependency in useEffect
The \`useEffect\` hook is missing \`count\` in its dependency array, which could cause stale closure bugs.

\`\`\`typescript
// Bad
useEffect(() => {
  console.log(count);
}, []); // Missing count!

// Good
useEffect(() => {
  console.log(count);
}, [count]);
\`\`\`

### 2. Potential memory leak
The event listener is not cleaned up:

\`\`\`typescript
useEffect(() => {
  window.addEventListener('resize', handleResize);
  // Missing cleanup!
  return () => {
    window.removeEventListener('resize', handleResize);
  };
}, []);
\`\`\`

[!WARNING]
Always clean up subscriptions and event listeners to prevent memory leaks.

[!TIP]
Consider using a custom hook like \`useEventListener\` for cleaner code.

| Issue | Severity | Status |
|-------|----------|--------|
| Missing deps | High | Open |
| Memory leak | Critical | Open |
| Type safety | Medium | Fixed |`,
        createdAt: new Date(Date.now() - 30000),
      },
      {
        id: 'm3',
        sessionId: '1',
        role: 'user',
        content: 'Thanks! Can you fix the memory leak issue?',
        createdAt: new Date(),
      }
    ];

    const mockAgents = [
      { id: '1', name: 'reviewer-fe', description: 'Frontend code reviewer', type: 'reviewer', model: 'opus', version: '1.0', tokens: 1000, color: '#6366f1', path: '/agents/reviewer-fe.md' },
      { id: '2', name: 'fixer', description: 'Automatic issue fixer', type: 'fixer', model: 'sonnet', version: '1.0', tokens: 800, color: '#10b981', path: '/agents/fixer.md' },
      { id: '3', name: 'analyzer', description: 'Code analyzer', type: 'analyzer', model: 'haiku', version: '1.0', tokens: 500, color: '#f59e0b', path: '/agents/analyzer.md' },
      { id: '4', name: 'architect', description: 'System architecture designer', type: 'planner', model: 'opus', version: '1.0', tokens: 1200, color: '#ec4899', path: '/agents/architect.md' },
    ];

    const mockRepositories = [
      { id: 'r1', name: 'turbowrap', fullName: 'turbowrap/turbowrap', path: '/repos/turbowrap', defaultBranch: 'main' },
      { id: 'r2', name: 'frontend', fullName: 'turbowrap/frontend', path: '/repos/frontend', defaultBranch: 'main' },
      { id: 'r3', name: 'api-server', fullName: 'turbowrap/api-server', path: '/repos/api', defaultBranch: 'develop' },
    ];

    // Demo App
    function DemoApp() {
      const [activeSessionId, setActiveSessionId] = useState('1');
      const [showHistory, setShowHistory] = useState(false);
      const [showRepoModal, setShowRepoModal] = useState(false);
      const [showSessionInfo, setShowSessionInfo] = useState(false);
      const [isStreaming, setIsStreaming] = useState(false);
      const [streamContent, setStreamContent] = useState('');
      const [showAutocomplete, setShowAutocomplete] = useState(false);
      const [autocompleteIndex, setAutocompleteIndex] = useState(0);
      const [darkMode, setDarkMode] = useState(true);

      const activeSession = mockSessions.find(s => s.id === activeSessionId);
      const sessionMessages = mockMessages.filter(m => m.sessionId === activeSessionId);

      // Simulate streaming
      const handleSend = (content) => {
        console.log('Sending:', content);
        setIsStreaming(true);
        setStreamContent('');

        const response = `I'll fix that memory leak for you. Here's the corrected implementation with proper cleanup:

\`\`\`typescript
import { useEffect, useCallback } from 'react';

function useWindowResize(callback: () => void) {
  const handleResize = useCallback(() => {
    callback();
  }, [callback]);

  useEffect(() => {
    window.addEventListener('resize', handleResize);

    // Proper cleanup function
    return () => {
      window.removeEventListener('resize', handleResize);
    };
  }, [handleResize]);
}
\`\`\`

[!SUCCESS]
The memory leak has been fixed! The cleanup function now properly removes the event listener when the component unmounts.`;

        let i = 0;
        const interval = setInterval(() => {
          if (i < response.length) {
            setStreamContent(prev => prev + response[i]);
            i++;
          } else {
            clearInterval(interval);
            setTimeout(() => setIsStreaming(false), 500);
          }
        }, 15);
      };

      return h('div', { className: 'min-h-screen p-6 md:p-10' },
        // Header
        h('div', { className: 'max-w-7xl mx-auto mb-10 animate-fade-in' },
          h('div', { className: 'flex items-center justify-between' },
            h('div', null,
              h('h1', {
                className: 'text-4xl md:text-5xl font-bold bg-gradient-to-r from-indigo-400 via-purple-400 to-pink-400 bg-clip-text text-transparent'
              }, '@turbowrap/chat'),
              h('p', { className: 'text-gray-400 mt-2 text-lg' }, 'Modern React chat components with real-time streaming')
            ),
            h('div', { className: 'flex items-center gap-4' },
              h('a', {
                href: 'https://github.com/turbowrap/chat',
                target: '_blank',
                className: 'glass px-4 py-2 rounded-lg text-gray-300 hover:text-white transition-colors flex items-center gap-2'
              },
                h('svg', { className: 'w-5 h-5', fill: 'currentColor', viewBox: '0 0 24 24' },
                  h('path', { d: 'M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z' })
                ),
                'GitHub'
              ),
              h('span', {
                className: 'glass px-3 py-1 rounded-full text-sm text-indigo-300 font-medium'
              }, 'v1.0.0')
            )
          )
        ),

        // Main Content
        h('div', { className: 'max-w-7xl mx-auto space-y-8' },

          // Full Chat Demo
          h('div', { className: 'demo-section glass-darker rounded-2xl overflow-hidden glow-indigo' },
            h('div', { className: 'px-6 py-4 border-b border-white/10 flex items-center justify-between' },
              h('div', { className: 'flex items-center gap-3' },
                h('div', { className: 'w-3 h-3 rounded-full bg-red-500' }),
                h('div', { className: 'w-3 h-3 rounded-full bg-yellow-500' }),
                h('div', { className: 'w-3 h-3 rounded-full bg-green-500' })
              ),
              h('span', { className: 'text-gray-400 text-sm font-medium' }, 'Full Chat Interface')
            ),
            h('div', { className: 'chat-container' },
              // Header
              h(ChatHeader, {
                chatMode: 'full',
                showHistory: showHistory,
                onToggleHistory: () => setShowHistory(!showHistory),
                onNewChat: (type) => console.log('New chat:', type),
                onExpand: () => console.log('Expand'),
                onClose: () => console.log('Close'),
              },
                h(SessionTabs, {
                  sessions: mockSessions,
                  activeSessionId: activeSessionId,
                  onSelect: setActiveSessionId,
                })
              ),

              // Quick Settings
              activeSession && h(QuickSettings, {
                session: activeSession,
                repository: mockRepositories[0],
                branches: ['main', 'develop', 'feature/chat'],
                currentBranch: 'main',
                onModelChange: (model) => console.log('Model:', model),
                onRepoClick: () => setShowRepoModal(true),
                onBranchChange: (branch) => console.log('Branch:', branch),
                onInfoClick: () => setShowSessionInfo(true),
              }),

              // Messages
              h(MessageList, {
                messages: sessionMessages,
                isStreaming: isStreaming,
                streamContent: streamContent,
                streamSegments: streamContent ? [{ type: 'text', content: streamContent }] : [],
                activeTools: [],
                activeAgents: [],
                className: 'flex-1 bg-black/20',
              }),

              // Input
              h(MessageInput, {
                onSend: handleSend,
                onStop: () => setIsStreaming(false),
                isStreaming: isStreaming,
                placeholder: 'Type a message or @mention an agent...',
              }),

              // History Panel
              h(HistoryPanel, {
                isOpen: showHistory,
                sessions: mockSessions,
                activeSessionId: activeSessionId,
                onClose: () => setShowHistory(false),
                onSelect: (id) => { setActiveSessionId(id); setShowHistory(false); },
                onDelete: (id) => console.log('Delete:', id),
                onNewChat: (type) => console.log('New:', type),
              })
            )
          ),

          // Two column layout for smaller demos
          h('div', { className: 'grid grid-cols-1 lg:grid-cols-2 gap-8' },

            // MessageFormatter Demo
            h('div', { className: 'demo-section glass-darker rounded-2xl overflow-hidden glow-purple' },
              h('div', { className: 'px-6 py-4 border-b border-white/10' },
                h('h3', { className: 'text-lg font-semibold text-white' }, 'Markdown Rendering'),
                h('p', { className: 'text-gray-400 text-sm mt-1' }, 'Full markdown support with syntax highlighting')
              ),
              h('div', { className: 'p-6 max-h-96 overflow-y-auto' },
                h(MessageFormatter, {
                  content: `# Markdown Demo

## Code Blocks
\`\`\`typescript
function hello(name: string): string {
  return \`Hello, \${name}!\`;
}
\`\`\`

## Callouts
[!INFO]
This is an info callout with helpful information.

[!WARNING]
Be careful with this operation!

[!SUCCESS]
Operation completed successfully.

## Tables
| Feature | Status | Priority |
|---------|--------|----------|
| Dark mode | Done | High |
| SSE Streaming | Done | Critical |
| Dual chat | WIP | Medium |

## Text Formatting
- **Bold text** and *italic text*
- ~~Strikethrough~~ and ==highlighted==
- Inline \`code\` looks like this

> This is a blockquote with important information.`,
                  role: 'assistant',
                })
              )
            ),

            // Agent Autocomplete Demo
            h('div', { className: 'demo-section glass-darker rounded-2xl overflow-hidden' },
              h('div', { className: 'px-6 py-4 border-b border-white/10' },
                h('h3', { className: 'text-lg font-semibold text-white' }, '@mention Autocomplete'),
                h('p', { className: 'text-gray-400 text-sm mt-1' }, 'Type @ to mention agents in your messages')
              ),
              h('div', { className: 'p-6 relative', style: { minHeight: '320px' } },
                h('button', {
                  className: 'btn-glow px-6 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-xl font-medium',
                  onClick: () => setShowAutocomplete(!showAutocomplete),
                }, showAutocomplete ? 'Hide Autocomplete' : 'Show @mention Menu'),
                showAutocomplete && h(AgentAutocomplete, {
                  isOpen: true,
                  agents: mockAgents,
                  filter: '',
                  selectedIndex: autocompleteIndex,
                  position: { top: 70, left: 0 },
                  onSelect: (agent) => { console.log('Selected:', agent); setShowAutocomplete(false); },
                  onClose: () => setShowAutocomplete(false),
                  onNavigate: (dir) => {
                    if (dir === 'up') setAutocompleteIndex(Math.max(0, autocompleteIndex - 1));
                    else setAutocompleteIndex(Math.min(mockAgents.length - 1, autocompleteIndex + 1));
                  },
                })
              )
            )
          ),

          // Tool Indicators
          h('div', { className: 'demo-section glass-darker rounded-2xl overflow-hidden' },
            h('div', { className: 'px-6 py-4 border-b border-white/10' },
              h('h3', { className: 'text-lg font-semibold text-white' }, 'Tool & Agent Indicators'),
              h('p', { className: 'text-gray-400 text-sm mt-1' }, 'Real-time feedback when AI uses tools')
            ),
            h('div', { className: 'p-6 grid grid-cols-1 md:grid-cols-3 gap-4' },
              h(ToolIndicator, {
                tool: { name: 'Read', id: 'tool-1', startedAt: Date.now(), input: { file_path: 'src/components/Chat.tsx' } },
              }),
              h(ToolIndicator, {
                tool: { name: 'Grep', id: 'tool-2', startedAt: Date.now(), input: { pattern: 'useEffect' } },
              }),
              h(ToolIndicator, {
                agent: { type: 'Task', model: 'sonnet', description: 'Analyzing component dependencies...', startedAt: Date.now() },
              })
            )
          ),

          // Modals Demo
          h('div', { className: 'demo-section glass-darker rounded-2xl overflow-hidden' },
            h('div', { className: 'px-6 py-4 border-b border-white/10' },
              h('h3', { className: 'text-lg font-semibold text-white' }, 'Modal Components'),
              h('p', { className: 'text-gray-400 text-sm mt-1' }, 'Repository selector and session info modals')
            ),
            h('div', { className: 'p-6 flex flex-wrap gap-4' },
              h('button', {
                className: 'btn-glow px-6 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-xl font-medium',
                onClick: () => setShowRepoModal(true),
              }, 'Open Repository Selector'),
              h('button', {
                className: 'btn-glow px-6 py-3 bg-gradient-to-r from-pink-600 to-rose-600 text-white rounded-xl font-medium',
                onClick: () => setShowSessionInfo(true),
              }, 'Open Session Info')
            )
          ),

          // Footer
          h('div', { className: 'text-center py-8 text-gray-500' },
            h('p', null, 'Built with React 18 + Zustand + Tailwind CSS'),
            h('p', { className: 'text-sm mt-2' }, 'Part of the TurboWrap platform')
          )
        ),

        // Modals
        h(RepoSelectorModal, {
          isOpen: showRepoModal,
          repositories: mockRepositories,
          selectedRepoId: 'r1',
          onSelect: (id) => console.log('Selected repo:', id),
          onClose: () => setShowRepoModal(false),
        }),

        h(SessionInfoModal, {
          isOpen: showSessionInfo,
          session: activeSession,
          contextInfo: {
            model: 'claude-sonnet-4-20250514',
            tokens: { used: 45000, limit: 200000, percentage: 22.5 },
            categories: [
              { name: 'System', tokens: 5000 },
              { name: 'User', tokens: 15000 },
              { name: 'Assistant', tokens: 25000 },
            ],
            mcpTools: [],
            agents: [],
          },
          usageInfo: {
            inputTokens: 15000,
            outputTokens: 25000,
            cacheReadTokens: 5000,
            cost: 0.0234,
            mcpServers: [],
          },
          onClose: () => setShowSessionInfo(false),
        })
      );
    }

    // Render
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(h(DemoApp));
  </script>
</body>
</html>
